import requests
import json
import database
import base64


# Connect to the database
connection = database.connect_to_database()

# Create a cursor
cursor = connection.cursor()

# Query to get the user token and userName
user_id = 391997
sql_token = f"SELECT token FROM user WHERE userId = '{user_id}'"
sql_user = f"SELECT userName FROM user WHERE userId = '{user_id}'"
sql_address = f"SELECT address FROM user_info WHERE userId = '{user_id}'"

# Get the token from the database
cursor.execute(sql_token)
result = cursor.fetchall()

# Get the userName from the database
cursor.execute(sql_user)
result_user = cursor.fetchall()
user_name = result_user[0][0]

# Get the address from the database
cursor.execute(sql_address)
result_address = cursor.fetchall()
address = result_address[0][0]

# Print the userName and address
# print(user_name)
# print(address)

# Close the connection
cursor.close()
connection.close()

# 使用 base64 对地址进行编码
encoded_address = base64.b64encode(address.encode("utf-8"))
# str转化为 utf-8 编码
encoded_address64 = str(encoded_address, 'utf-8')

# # 从 base64 解码地址
# decoded_address = base64.b64decode(encoded_address).decode("utf-8")

# # 打印编码和解码后的地址
# print("编码后的地址：", encoded_address64)

# print("解码后的地址：", decoded_address)


# msg = '冉金坤'
# code = '打卡成功'
# title = "{},{}".format(msg, code)
# content = '四川省成都市成华区成都太古里河畔亚朵酒店'

# url = "https://www.pushplus.plus/send"

# payload = json.dumps({
#    "token": "87cdcff73305443c9eb690fe2169fa31",
#    "title": title,
#    "content": content,
#    "template": "markdown"
# })
# headers = {
#    'User-Agent': 'Apifox/1.0.0 (https://apifox.com)',
#    'Content-Type': 'application/json'
# }

# response = requests.request("POST", url, headers=headers, data=payload)

# print(response.text)